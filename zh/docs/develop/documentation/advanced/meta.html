<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Metaprogramming | Taichi</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="Taichiç¼–ç¨‹è¯­è¨€">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="og:locale" content="en_US">
    
    <link rel="preload" href="/assets/css/0.styles.0090509f.css" as="style"><link rel="preload" href="/assets/js/app.560b3eba.js" as="script"><link rel="preload" href="/assets/js/5.993c5026.js" as="script"><link rel="preload" href="/assets/js/84.2047c036.js" as="script"><link rel="prefetch" href="/assets/js/1.77225987.js"><link rel="prefetch" href="/assets/js/10.524d882a.js"><link rel="prefetch" href="/assets/js/100.ceaf067c.js"><link rel="prefetch" href="/assets/js/101.7f9ef2ee.js"><link rel="prefetch" href="/assets/js/102.65f03cfa.js"><link rel="prefetch" href="/assets/js/103.8f21c5f6.js"><link rel="prefetch" href="/assets/js/104.cd00125c.js"><link rel="prefetch" href="/assets/js/105.358b30d5.js"><link rel="prefetch" href="/assets/js/106.21d0f22e.js"><link rel="prefetch" href="/assets/js/107.776236e8.js"><link rel="prefetch" href="/assets/js/108.9da3eb67.js"><link rel="prefetch" href="/assets/js/109.0cf8b4e0.js"><link rel="prefetch" href="/assets/js/11.86124f94.js"><link rel="prefetch" href="/assets/js/110.fc72a64a.js"><link rel="prefetch" href="/assets/js/111.e7074b06.js"><link rel="prefetch" href="/assets/js/112.aca9a898.js"><link rel="prefetch" href="/assets/js/113.18157e1e.js"><link rel="prefetch" href="/assets/js/114.2f83aa90.js"><link rel="prefetch" href="/assets/js/115.8ada3c44.js"><link rel="prefetch" href="/assets/js/116.2d5f810c.js"><link rel="prefetch" href="/assets/js/117.e8945cb5.js"><link rel="prefetch" href="/assets/js/118.e78501d8.js"><link rel="prefetch" href="/assets/js/119.7b413825.js"><link rel="prefetch" href="/assets/js/12.45cdf807.js"><link rel="prefetch" href="/assets/js/13.a9bf7f8d.js"><link rel="prefetch" href="/assets/js/14.5033310e.js"><link rel="prefetch" href="/assets/js/15.343f117b.js"><link rel="prefetch" href="/assets/js/16.7626e42c.js"><link rel="prefetch" href="/assets/js/17.4eac17d3.js"><link rel="prefetch" href="/assets/js/18.172e4073.js"><link rel="prefetch" href="/assets/js/19.be952f94.js"><link rel="prefetch" href="/assets/js/2.eacc9a36.js"><link rel="prefetch" href="/assets/js/20.a8fb024b.js"><link rel="prefetch" href="/assets/js/21.bef32217.js"><link rel="prefetch" href="/assets/js/22.dae939b9.js"><link rel="prefetch" href="/assets/js/23.60adab24.js"><link rel="prefetch" href="/assets/js/24.2562c988.js"><link rel="prefetch" href="/assets/js/25.8b28d1b8.js"><link rel="prefetch" href="/assets/js/26.86158712.js"><link rel="prefetch" href="/assets/js/27.7abf845c.js"><link rel="prefetch" href="/assets/js/28.d289fc84.js"><link rel="prefetch" href="/assets/js/29.cc80ce35.js"><link rel="prefetch" href="/assets/js/30.1c7a237d.js"><link rel="prefetch" href="/assets/js/31.ad19995b.js"><link rel="prefetch" href="/assets/js/32.1d296baf.js"><link rel="prefetch" href="/assets/js/33.a4b94522.js"><link rel="prefetch" href="/assets/js/34.e2ebbf94.js"><link rel="prefetch" href="/assets/js/35.e5d896a5.js"><link rel="prefetch" href="/assets/js/36.f4820a14.js"><link rel="prefetch" href="/assets/js/37.76c586cf.js"><link rel="prefetch" href="/assets/js/38.e409501b.js"><link rel="prefetch" href="/assets/js/39.4be16f08.js"><link rel="prefetch" href="/assets/js/4.fd608932.js"><link rel="prefetch" href="/assets/js/40.8dc37318.js"><link rel="prefetch" href="/assets/js/41.453a947b.js"><link rel="prefetch" href="/assets/js/42.9dcdc567.js"><link rel="prefetch" href="/assets/js/43.602d768c.js"><link rel="prefetch" href="/assets/js/44.8c600b69.js"><link rel="prefetch" href="/assets/js/45.5da53873.js"><link rel="prefetch" href="/assets/js/46.eaa4fc71.js"><link rel="prefetch" href="/assets/js/47.0f77c6f6.js"><link rel="prefetch" href="/assets/js/48.21ce2044.js"><link rel="prefetch" href="/assets/js/49.d99d3371.js"><link rel="prefetch" href="/assets/js/50.d53f66e8.js"><link rel="prefetch" href="/assets/js/51.c7da60d7.js"><link rel="prefetch" href="/assets/js/52.53c7abf7.js"><link rel="prefetch" href="/assets/js/53.c3377e8a.js"><link rel="prefetch" href="/assets/js/54.f3d7b76a.js"><link rel="prefetch" href="/assets/js/55.cb3eccb9.js"><link rel="prefetch" href="/assets/js/56.526ea3f8.js"><link rel="prefetch" href="/assets/js/57.027fcaa0.js"><link rel="prefetch" href="/assets/js/58.9ac5e4a1.js"><link rel="prefetch" href="/assets/js/59.40a78218.js"><link rel="prefetch" href="/assets/js/6.19e5cd94.js"><link rel="prefetch" href="/assets/js/60.53a0974f.js"><link rel="prefetch" href="/assets/js/61.2220770b.js"><link rel="prefetch" href="/assets/js/62.f9f7c500.js"><link rel="prefetch" href="/assets/js/63.ca4b406d.js"><link rel="prefetch" href="/assets/js/64.90671150.js"><link rel="prefetch" href="/assets/js/65.ec9bd7d3.js"><link rel="prefetch" href="/assets/js/66.3579d976.js"><link rel="prefetch" href="/assets/js/67.d976ce7f.js"><link rel="prefetch" href="/assets/js/68.cc6cd5a8.js"><link rel="prefetch" href="/assets/js/69.17deae47.js"><link rel="prefetch" href="/assets/js/7.bb2d2093.js"><link rel="prefetch" href="/assets/js/70.a4ab371a.js"><link rel="prefetch" href="/assets/js/71.5b1d65b5.js"><link rel="prefetch" href="/assets/js/72.946cf198.js"><link rel="prefetch" href="/assets/js/73.2d8e8240.js"><link rel="prefetch" href="/assets/js/74.60bee241.js"><link rel="prefetch" href="/assets/js/75.8984b81b.js"><link rel="prefetch" href="/assets/js/76.3ff4a068.js"><link rel="prefetch" href="/assets/js/77.39c2eb21.js"><link rel="prefetch" href="/assets/js/78.13c430e1.js"><link rel="prefetch" href="/assets/js/79.aa5bfef0.js"><link rel="prefetch" href="/assets/js/8.1c978201.js"><link rel="prefetch" href="/assets/js/80.4f5f00ad.js"><link rel="prefetch" href="/assets/js/81.104862b4.js"><link rel="prefetch" href="/assets/js/82.ff8b3c53.js"><link rel="prefetch" href="/assets/js/83.48a3cb50.js"><link rel="prefetch" href="/assets/js/85.d11ab937.js"><link rel="prefetch" href="/assets/js/86.885a0312.js"><link rel="prefetch" href="/assets/js/87.f13418ab.js"><link rel="prefetch" href="/assets/js/88.5dff2c64.js"><link rel="prefetch" href="/assets/js/89.0ab73864.js"><link rel="prefetch" href="/assets/js/9.4725819b.js"><link rel="prefetch" href="/assets/js/90.58cec2ad.js"><link rel="prefetch" href="/assets/js/91.dd529953.js"><link rel="prefetch" href="/assets/js/92.af715f3b.js"><link rel="prefetch" href="/assets/js/93.efc40d69.js"><link rel="prefetch" href="/assets/js/94.078322eb.js"><link rel="prefetch" href="/assets/js/95.2d2171b1.js"><link rel="prefetch" href="/assets/js/96.41854fb0.js"><link rel="prefetch" href="/assets/js/97.d981750a.js"><link rel="prefetch" href="/assets/js/98.d7c318db.js"><link rel="prefetch" href="/assets/js/99.9fd11517.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0090509f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/logo_medium.png" alt="Taichi" class="logo"> <span class="site-name can-hide">Taichi</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ–‡æ¡£" class="dropdown-title"><span class="title">æ–‡æ¡£</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ–‡æ¡£" class="mobile-dropdown-title"><span class="title">æ–‡æ¡£</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/develop/documentation/overview/overview.html" class="nav-link">
  develop
</a></li></ul></div></div><div class="nav-item"><a href="/zh/tutorials/" class="nav-link">
  æ•™ç¨‹
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="äº†è§£æ›´å¤š" class="dropdown-title"><span class="title">äº†è§£æ›´å¤š</span> <span class="arrow down"></span></button> <button type="button" aria-label="äº†è§£æ›´å¤š" class="mobile-dropdown-title"><span class="title">äº†è§£æ›´å¤š</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          æ¢ç´¢
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/gallery/" class="nav-link">
  ç”»å»Š
</a></li><li class="dropdown-subitem"><a href="/zh/research/" class="nav-link">
  ç ”ç©¶
</a></li><li class="dropdown-subitem"><a href="http://hub.taichi.graphics/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Taichi Hubæ¸¸ä¹åœº
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          èµ„æº
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/contribution/" class="nav-link">
  è´¡çŒ®æŒ‡å—
</a></li><li class="dropdown-subitem"><a href="/zh/events/" class="nav-link">
  æ´»åŠ¨
</a></li><li class="dropdown-subitem"><a href="https://github.com/taichi-dev/taichi/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ›´æ–°æ—¥å¿—
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          å¸¸è§é—®é¢˜
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/faq/" class="nav-link">
  FAQ
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://forum.taichi.graphics/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è®ºå›
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/zh/community/" class="nav-link">
  ç¤¾åŒº
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è¯­è¨€" class="dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow down"></span></button> <button type="button" aria-label="è¯­è¨€" class="mobile-dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/develop/documentation/advanced/meta.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/docs/develop/documentation/advanced/meta.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  ç®€ä½“ä¸­æ–‡
</a></li></ul></div></div> <a href="https://github.com/taichi-dev/taichi" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ–‡æ¡£" class="dropdown-title"><span class="title">æ–‡æ¡£</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ–‡æ¡£" class="mobile-dropdown-title"><span class="title">æ–‡æ¡£</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/develop/documentation/overview/overview.html" class="nav-link">
  develop
</a></li></ul></div></div><div class="nav-item"><a href="/zh/tutorials/" class="nav-link">
  æ•™ç¨‹
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="äº†è§£æ›´å¤š" class="dropdown-title"><span class="title">äº†è§£æ›´å¤š</span> <span class="arrow down"></span></button> <button type="button" aria-label="äº†è§£æ›´å¤š" class="mobile-dropdown-title"><span class="title">äº†è§£æ›´å¤š</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          æ¢ç´¢
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/gallery/" class="nav-link">
  ç”»å»Š
</a></li><li class="dropdown-subitem"><a href="/zh/research/" class="nav-link">
  ç ”ç©¶
</a></li><li class="dropdown-subitem"><a href="http://hub.taichi.graphics/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Taichi Hubæ¸¸ä¹åœº
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          èµ„æº
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/contribution/" class="nav-link">
  è´¡çŒ®æŒ‡å—
</a></li><li class="dropdown-subitem"><a href="/zh/events/" class="nav-link">
  æ´»åŠ¨
</a></li><li class="dropdown-subitem"><a href="https://github.com/taichi-dev/taichi/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ›´æ–°æ—¥å¿—
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          å¸¸è§é—®é¢˜
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/faq/" class="nav-link">
  FAQ
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://forum.taichi.graphics/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è®ºå›
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/zh/community/" class="nav-link">
  ç¤¾åŒº
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è¯­è¨€" class="dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow down"></span></button> <button type="button" aria-label="è¯­è¨€" class="mobile-dropdown-title"><span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/develop/documentation/advanced/meta.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/docs/develop/documentation/advanced/meta.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  ç®€ä½“ä¸­æ–‡
</a></li></ul></div></div> <a href="https://github.com/taichi-dev/taichi" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ¦‚è§ˆ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>åŸºæœ¬æ¦‚å¿µ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>é«˜çº§ç¼–ç¨‹</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/docs/develop/documentation/advanced/meta.html" aria-current="page" class="active sidebar-link">Metaprogramming</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/docs/develop/documentation/advanced/meta.html#template-metaprogramming" class="sidebar-link">Template metaprogramming</a></li><li class="sidebar-sub-header"><a href="/zh/docs/develop/documentation/advanced/meta.html#dimensionality-independent-programming-using-grouped-indices" class="sidebar-link">Dimensionality-independent programming using grouped indices</a></li><li class="sidebar-sub-header"><a href="/zh/docs/develop/documentation/advanced/meta.html#field-metadata" class="sidebar-link">Field metadata</a></li><li class="sidebar-sub-header"><a href="/zh/docs/develop/documentation/advanced/meta.html#matrix-vector-metadata" class="sidebar-link">Matrix &amp; vector metadata</a></li><li class="sidebar-sub-header"><a href="/zh/docs/develop/documentation/advanced/meta.html#compile-time-evaluations" class="sidebar-link">Compile-time evaluations</a></li><li class="sidebar-sub-header"><a href="/zh/docs/develop/documentation/advanced/meta.html#when-to-use-for-loops-with-ti-static" class="sidebar-link">When to use for loops with ti.static</a></li></ul></li><li><a href="/zh/docs/develop/documentation/advanced/layout.html" class="sidebar-link">Advanced dense layouts</a></li><li><a href="/zh/docs/develop/documentation/advanced/sparse.html" class="sidebar-link">Sparse computation (WIP)</a></li><li><a href="/zh/docs/develop/documentation/advanced/differentiable_programming.html" class="sidebar-link">Differentiable programming</a></li><li><a href="/zh/docs/develop/documentation/advanced/performance.html" class="sidebar-link">Performance tuning</a></li><li><a href="/zh/docs/develop/documentation/advanced/odop.html" class="sidebar-link">Objective data-oriented programming</a></li><li><a href="/zh/docs/develop/documentation/advanced/syntax_sugars.html" class="sidebar-link">Syntax sugars</a></li><li><a href="/zh/docs/develop/documentation/advanced/offset.html" class="sidebar-link">Coordinate offsets</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>API å‚è€ƒæ‰‹å†Œ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ‚é¡¹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>è‡´è°¢</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é—ç•™ç³»ç»Ÿ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="metaprogramming"><a href="#metaprogramming" class="header-anchor">#</a> Metaprogramming</h1> <p>Taichi provides metaprogramming infrastructures. Metaprogramming can</p> <ul><li>Unify the development of dimensionality-dependent code, such as
2D/3D physical simulations</li> <li>Improve run-time performance by from run-time costs to compile time</li> <li>Simplify the development of Taichi standard library</li></ul> <p>Taichi kernels are <em>lazily instantiated</em> and a lot of computation can
happen at <em>compile-time</em>. Every kernel in Taichi is a template kernel,
even if it has no template arguments.</p> <h2 id="template-metaprogramming"><a href="#template-metaprogramming" class="header-anchor">#</a> Template metaprogramming</h2> <p>You may use <code>ti.template()</code> as a type hint to pass a field as an
argument. For example:</p> <div class="language-python extra-class"><div class="highlight-lines"><br><div class="highlighted">Â </div><br><br><br><br><br><br><br><br><br><br></div><pre class="language-python"><code><span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">copy</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> ti<span class="token punctuation">.</span>template<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> ti<span class="token punctuation">.</span>template<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> x<span class="token punctuation">:</span>
        y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

a <span class="token operator">=</span> ti<span class="token punctuation">.</span>field<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>f32<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> ti<span class="token punctuation">.</span>field<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>f32<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> ti<span class="token punctuation">.</span>field<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>f32<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> ti<span class="token punctuation">.</span>field<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>f32<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
copy<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
copy<span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">)</span>
</code></pre></div><p>As shown in the example above, template programming may enable us to
reuse our code and provide more flexibility.</p> <h2 id="dimensionality-independent-programming-using-grouped-indices"><a href="#dimensionality-independent-programming-using-grouped-indices" class="header-anchor">#</a> Dimensionality-independent programming using grouped indices</h2> <p>However, the <code>copy</code> template shown above is not perfect. For example, it
can only be used to copy 1D fields. What if we want to copy 2D fields?
Do we have to write another kernel?</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">copy2d</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> ti<span class="token punctuation">.</span>template<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> ti<span class="token punctuation">.</span>template<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> x<span class="token punctuation">:</span>
        y<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span>
</code></pre></div><p>ğŸ‰ Not necessary! Taichi provides <code>ti.grouped</code> syntax which enables you to
pack loop indices into a grouped vector to unify kernels of different
dimensionalities. For example:</p> <div class="language-python extra-class"><div class="highlight-lines"><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><br><br><br><br><br></div><pre class="language-python"><code><span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">copy</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> ti<span class="token punctuation">.</span>template<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> ti<span class="token punctuation">.</span>template<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> I <span class="token keyword">in</span> ti<span class="token punctuation">.</span>grouped<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># I is a vector with same dimensionality with x and data type i32</span>
        <span class="token comment"># If y is 0D, then I = ti.Vector([]), which is equivalent to `None` when used in x[I]</span>
        <span class="token comment"># If y is 1D, then I = ti.Vector([i])</span>
        <span class="token comment"># If y is 2D, then I = ti.Vector([i, j])</span>
        <span class="token comment"># If y is 3D, then I = ti.Vector([i, j, k])</span>
        <span class="token comment"># ...</span>
        x<span class="token punctuation">[</span>I<span class="token punctuation">]</span> <span class="token operator">=</span> y<span class="token punctuation">[</span>I<span class="token punctuation">]</span>

<span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">array_op</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> ti<span class="token punctuation">.</span>template<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> ti<span class="token punctuation">.</span>template<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># if field x is 2D:</span>
    <span class="token keyword">for</span> I <span class="token keyword">in</span> ti<span class="token punctuation">.</span>grouped<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># I is simply a 2D vector with data type i32</span>
        y<span class="token punctuation">[</span>I <span class="token operator">+</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> I<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> I<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

    <span class="token comment"># then it is equivalent to:</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> x<span class="token punctuation">:</span>
        y<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> j
</code></pre></div><h2 id="field-metadata"><a href="#field-metadata" class="header-anchor">#</a> Field metadata</h2> <p>Sometimes it is useful to get the data type (<code>field.dtype</code>) and shape
(<code>field.shape</code>) of fields. These attributes can be accessed in both
Taichi- and Python-scopes.</p> <div class="language-python extra-class"><div class="highlight-lines"><br><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><div class="highlighted">Â </div><br></div><pre class="language-python"><code><span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>func</span>
<span class="token keyword">def</span> <span class="token function">print_field_info</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> ti<span class="token punctuation">.</span>template<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Field dimensionality is'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> ti<span class="token punctuation">.</span>static<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Size alone dimension'</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token string">'is'</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    ti<span class="token punctuation">.</span>static_print<span class="token punctuation">(</span><span class="token string">'Field data type is'</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>dtype<span class="token punctuation">)</span>
</code></pre></div><p>See <a href="/zh/docs/develop/documentation/api/scalar_field.html">Scalar fields</a> for more details.</p> <div class="custom-block note"><p class="custom-block-title">æ³¨è§£</p> <p>For sparse fields, the full domain shape will be returned.</p></div> <h2 id="matrix-vector-metadata"><a href="#matrix-vector-metadata" class="header-anchor">#</a> Matrix &amp; vector metadata</h2> <p>Getting the number of matrix columns and rows will allow you to write
dimensionality-independent code. For example, this can be used to unify
2D and 3D physical simulators.</p> <p><code>matrix.m</code> equals to the number of columns of a matrix, while <code>matrix.n</code>
equals to the number of rows of a matrix. Since vectors are considered
as matrices with one column, <code>vector.n</code> is simply the dimensionality of
the vector.</p> <div class="language-python extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted">Â </div><div class="highlighted">Â </div><br><div class="highlighted">Â </div><div class="highlighted">Â </div><br></div><pre class="language-python"><code><span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    matrix <span class="token operator">=</span> ti<span class="token punctuation">.</span>Matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>matrix<span class="token punctuation">.</span>n<span class="token punctuation">)</span>  <span class="token comment"># 3</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>matrix<span class="token punctuation">.</span>m<span class="token punctuation">)</span>  <span class="token comment"># 2</span>
    vector <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>vector<span class="token punctuation">.</span>n<span class="token punctuation">)</span>  <span class="token comment"># 3</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>vector<span class="token punctuation">.</span>m<span class="token punctuation">)</span>  <span class="token comment"># 1</span>
</code></pre></div><h2 id="compile-time-evaluations"><a href="#compile-time-evaluations" class="header-anchor">#</a> Compile-time evaluations</h2> <p>Using compile-time evaluation will allow certain computations to happen
when kernels are being instantiated. This saves the overhead of those
computations at runtime.</p> <ul><li>Use <code>ti.static</code> for compile-time branching (for those who come from
C++17, this is <a href="https://en.cppreference.com/w/cpp/language/if" target="_blank" rel="noopener noreferrer">if
constexpr<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.):</li></ul> <div class="language-python extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted">Â </div><br><br></div><pre class="language-python"><code>enable_projection <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">static</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">if</span> ti<span class="token punctuation">.</span>static<span class="token punctuation">(</span>enable_projection<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># No runtime overhead</span>
    x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
</code></pre></div><ul><li>Use <code>ti.static</code> for forced loop unrolling:</li></ul> <div class="language-python extra-class"><div class="highlight-lines"><br><br><div class="highlighted">Â </div><br><br><br><br><br><br><br><br></div><pre class="language-python"><code><span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">for</span> i <span class="token keyword">in</span> ti<span class="token punctuation">.</span>static<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

  <span class="token comment"># is equivalent to:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="when-to-use-for-loops-with-ti-static"><a href="#when-to-use-for-loops-with-ti-static" class="header-anchor">#</a> When to use for loops with <code>ti.static</code></h2> <p>There are several reasons why <code>ti.static</code> for loops should be used.</p> <ul><li>Loop unrolling for performance.</li> <li>Loop over vector/matrix elements. Indices into Taichi matrices must be a compile-time constant. Indexing into taichi fields can be run-time variables. For example, if you want to access a vector field <code>x</code>, accessed as <code>x[field_index][vector_component_index]</code>. The first index can be variable, yet the second must be a constant.</li></ul> <p>For example, code for resetting this vector fields should be</p> <div class="language-python extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted">Â </div><br><br><br><br></div><pre class="language-python"><code><span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">for</span> i <span class="token keyword">in</span> x<span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> ti<span class="token punctuation">.</span>static<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token comment"># The inner loop must be unrolled since j is a vector index instead</span>
      <span class="token comment"># of a global field index.</span>
      x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/taichi-dev/taichi.graphics/edit/master/website/zh/docs/develop/documentation/advanced/meta.md" target="_blank" rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/24/2020, 1:03:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/zh/docs/develop/documentation/basic/external.html" class="prev">
        Interacting with external arrays
      </a></span> <span class="next"><a href="/zh/docs/develop/documentation/advanced/layout.html">
        Advanced dense layouts
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.560b3eba.js" defer></script><script src="/assets/js/5.993c5026.js" defer></script><script src="/assets/js/84.2047c036.js" defer></script>
  </body>
</html>
