# 场与矩阵

在 Taichi 中，场是全局变量。 场又分为稀疏场和稠密场。 一个场的元素可以是标量，也可以是向量或矩阵。

::: note
矩阵可以被用作场的元素，因此你可以创建每一个元素都是矩阵的场。
:::

## 标量场

- 每一个全局变量都是一个 N-维场。

  - 全局`标量`被视为0-维的标量场。

- 我们始终使用索引来访问场

  - 例如： 如果`x` 是一个3维标量场，则`x[i, j, k]`。
  - 即使访问0维场`x`，也应使用`x[None] = 0`而不是`x = 0`。 请**始终**使用索引访问场中的元素。

- 场的元素初始值全部为0。

- 稀疏场元素的初始状态是未被激活的。

- 请查看[标量场](../api/scalar_field.md)这一章节来了解更多详细信息。

## 矩阵场

场的元素可以是矩阵。

假设你有一个名为`A`的`128 x 64`的场，每一个元素都包含一个形状为`3 x 2`的矩阵。 要分配每一个元素都是一个`3 x 2`矩阵的形状为`128 x 64`的矩阵场，请使用声明`A = ti.Matrix.field(3, 2, dtype=ti.f32, shape=(128, 64))`。

- 如果你想获取网格节点`i, j`上的矩阵，请使用`mat = A[i, j]`。 `mat`是一个`3 x 2`的矩阵
- 要获取第1行第2列的矩阵元素，请使用`mat[0, 1]`或者`A[i, j][0, 1]`。
- 你可能已经注意到，当你从全局矩阵场加载矩阵元素时会有 **两个** 索引运算符`[]`：第一个用于场索引，而第二个则用于矩阵索引。
- `ti.Vector`其实只是`ti.Matrix`的别名。
- 有关矩阵的更多信息，请参见 [Matrices](../api/matrix.md) 。

## 矩阵大小

出于性能原因，矩阵操作的运算将被展开，因此我们建议仅使用小型的矩阵。 例如，`2x1`，`3x3`，`4x4`大小的矩阵运算还好，但`32x6`作为矩阵的大小可能过大了。

::: warning
由于展开机制的存在，在大型矩阵（例如 `32x128` ）上进行操作会导致很长的编译时间并带来较低的性能。
:::

如果你的矩阵的某维度很大（例如`64`），则最好定义一个大小为`64`的场。 例如，声明一个`ti.Matrix.field(64, 32, dtype=ti.f32, shape=(3, 2))`是不合理的，可以试着用`ti.Matrix.field(3, 2, dtype=ti.f32, shape=(64, 32))`来代替。 始终把大的维度放在场中而非矩阵中。
